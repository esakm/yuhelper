<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head th:replace="common/header.html :: common-header"/>

<body>


<div th:replace="common/header.html :: navbar"/>
<div class="main_container">
    <form class="course-search-form">
        <div class="col" id="autocomplete-container">
            <div class="row">
                <input class="form-control" autocomplete="off" type="text" placeholder="Search by course code or name" aria-label="Search" id="course-search-input">
            </div>
        </div>
    </form>
</div>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/js/content.js"></script>

<script type="text/javascript">
    document.getElementById("course-search-input").addEventListener("input", function(){
        lastReq.abort();
        if(document.getElementById("course-search-input").value === ''){
            let oldNodes = document.getElementsByClassName("autocomplete-item");
            if(oldNodes.length > 0){
                oldNodes = Array.prototype.slice.call(oldNodes);
                oldNodes.forEach( function (node) {
                    node.parentNode.removeChild(node);
                });
            }
            return;
        }
        var xhr = new XMLHttpRequest();
        xhr.overrideMimeType("application/json");
        xhr.open("GET", "/courses/autocomplete?course=" + document.getElementById("course-search-input").value);
        xhr.send();
        lastReq = xhr;
        xhr.onload = function () {
            if(xhr.status !== 200){
                return;
            }else{
                let oldNodes = document.getElementsByClassName("autocomplete-item");
                if(oldNodes.length > 0){
                    oldNodes = Array.prototype.slice.call(oldNodes);
                    oldNodes.forEach( function (node) {
                        node.parentNode.removeChild(node);
                    });
                }
                JSON.parse(xhr.response).forEach( function (course){
                    let mainNewNode = document.createElement('div');
                    mainNewNode.className = "row autocomplete-item";
                    let newNode = document.createElement('a');
                    newNode.href = "/" + encodeURI("course?q=" + course['coursePK']['courseCode'] + ' ' + course['coursePK']['credits']);
                    newNode.className = "list-group-item list-group-item-primary list-group-item-action flex-column";
                    let headingNode = document.createElement('h5');
                    headingNode.className = "mb-1";
                    headingNode.innerText = course['coursePK']['courseCode'] + ' ' + course['coursePK']['credits'];
                    newNode.appendChild(headingNode);
                    let containerNode = document.createElement('p');
                    containerNode.className = "mb-1";
                    containerNode.innerText = course['name'];
                    newNode.appendChild(containerNode);
                    mainNewNode.appendChild(newNode);
                    document.getElementById('autocomplete-container').appendChild(mainNewNode);
                });
            }
        };
    });
</script>
</body>
</html>